stage('Set Kubernetes Context') {
			steps {
				withAWS(region:'us-east-2', credentials:'pipeline') {
					sh 'kubectl config use-context ${cluster-arn}'
				}
			}
		}
    stage('Deploy Blue Container') {
			steps {
				withAWS(region:'us-east-2', credentials:'pipeline') {
					sh 'kubectl apply -f ./deployments/blue-controller.json'
				}
			}
		}

		stage('Deploy green container') {
			steps {
				withAWS(region:'us-east-2', credentials:'pipeline') {
					sh 'kubectl apply -f ./deployments/green-controller.json'
				}
			}
		}

		stage('Create the service in the cluster, redirect to blue') {
			steps {
				withAWS(region:'us-east-2', credentials:'pipeline') {
					sh 'kubectl apply -f ./deployments/blue-service.json'
				}
			}
		}
    stage('User Approval') {
      steps {
          input "Ready to redirect traffic to green?"
      }
    }
    stage('Create the service in the cluster, redirect to green') {
			steps {
				withAWS(region:'us-east-2', credentials:'pipeline') {
					sh '''
						kubectl apply -f ./deployments/green-service.json
					'''
				}
			}
		}